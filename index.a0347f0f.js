var e,t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r={},o={},s=t.parcelRequire7b01;null==s&&((s=function(e){if(e in r)return r[e].exports;if(e in o){var t=o[e];delete o[e];var s={id:e,exports:{}};return r[e]=s,t.call(s.exports,s,s.exports),s.exports}var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){o[e]=t},t.parcelRequire7b01=s),(0,s.register)("bOOQy",function(e,t){Object.defineProperty(e.exports,"DOM",{get:function(){return r},set:void 0,enumerable:!0,configurable:!0});let r={cells:document.querySelectorAll(".tile"),newGameButton:document.querySelector(".button--restart"),tryAgainButton:document.querySelector(".popup__button"),scoreSpan:document.querySelector(".stats__score"),bestSpan:document.querySelector(".stats__best"),message:document.querySelector(".popup__text"),messageBox:document.querySelector(".popup"),themeToggleButton:document.querySelector(".button--theme"),htmlElement:document.documentElement,iconSun:document.querySelector(".icon--sun"),iconMoon:document.querySelector(".icon--moon")}});var n=s("bOOQy"),i={};i=class{constructor(e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=this.copyBoard(e),this.board=this.copyBoard(e),this.score=0,this.status="idle"}getScore(){return this.score}getState(){return this.copyBoard(this.board)}getStatus(){return this.status}start(){this.status="playing",this.board=this.copyBoard(this.initialState),this.score=0,this.addRandomTile(),this.addRandomTile()}restart(){this.status="idle",this.board=this.copyBoard(this.initialState),this.score=0}moveLeft(){this.performMove(e=>this.merge(e))}moveRight(){this.performMove(e=>this.reverse(this.merge(this.reverse(e))))}moveUp(){this.performMove(e=>{let t=this.transpose(e),r=this.merge(t);return this.transpose(r)})}moveDown(){this.performMove(e=>{let t=this.transpose(e),r=this.reverse(t),o=this.merge(r),s=this.reverse(o);return this.transpose(s)})}performMove(e){if("playing"!==this.status)return;let t=this.copyBoard(this.board);this.board=e(this.board),this.areBoardsEqual(this.board,t)||this.addRandomTile(),this.has2048()?this.status="win":this.isGameOver()&&(this.status="lose")}areBoardsEqual(e,t){return e.every((e,r)=>e.every((e,o)=>e===t[r][o]))}merge(e){return e.map(e=>{let t=e.filter(e=>0!==e);for(let e=0;e<t.length-1;e++)t[e]===t[e+1]&&(t[e]*=2,this.score+=t[e],t.splice(e+1,1));for(;t.length<4;)t.push(0);return t})}transpose(e){return e[0].map((t,r)=>e.map(e=>e[r]))}reverse(e){return e.map(e=>[...e].reverse())}copyBoard(e){return e.map(e=>[...e])}addRandomTile(){let e=[];for(let t=0;t<4;t++)for(let r=0;r<4;r++)0===this.board[t][r]&&e.push({r:t,c:r});if(e.length>0){let{r:t,c:r}=e[Math.floor(Math.random()*e.length)];this.board[t][r]=.9>Math.random()?2:4}}has2048(){return this.board.flat().includes(2048)}isGameOver(){if(this.board.flat().includes(0))return!1;for(let e=0;e<4;e++)for(let t=0;t<4;t++){let r=this.board[e][t];if(e<3&&r===this.board[e+1][t]||t<3&&r===this.board[e][t+1])return!1}return!0}};var n=s("bOOQy");let a=[];function l(e){let t=e.getState(),r=t.flat(),o=a.flat();(0,n.DOM).cells.forEach((e,t)=>{let s=r[t],n=o[t];if(e.className="field-cell",s){let t=String(s).length;e.style.setProperty("--digits",t),e.textContent=s,e.classList.add(`field-cell--${s}`),0===n&&0!==s?e.classList.add("field-cell--new"):n&&s>n&&e.classList.add("field-cell--merged")}else e.textContent="",e.style.setProperty("--digits",1)}),a=t.map(e=>[...e]),n.DOM.scoreSpan.textContent=e.getScore(),function(e=0){let t=Number(localStorage.getItem("best-score"))||0;e>t?(localStorage.setItem("best-score",e),n.DOM.bestSpan.textContent=e):n.DOM.bestSpan.textContent=t}(e.getScore()),function(e){let t=e.getStatus();"win"===t?d("\uD83C\uDF89 Winner! Congrats!"):"lose"===t?d("You lose! Restart the game?"):u()}(e)}function d(e){n.DOM.message.textContent=e,(0,n.DOM).messageBox.classList.remove("hidden")}function u(){(0,n.DOM).messageBox.classList.add("hidden")}const c=new((e=i)&&e.__esModule?e.default:e);function h(){c.restart(),c.start(),u(),l(c)}let m=0,p=0;c.start(),l(c),(0,n.DOM).newGameButton.addEventListener("click",h),(0,n.DOM).tryAgainButton.addEventListener("click",h),window.addEventListener("keydown",function(e){let t={ArrowLeft:"moveLeft",a:"moveLeft",ArrowRight:"moveRight",d:"moveRight",ArrowUp:"moveUp",w:"moveUp",ArrowDown:"moveDown",s:"moveDown",n:"restart",r:"restart"}[e.key];if(t){if("restart"===t){h();return}"playing"===c.getStatus()&&(c[t](),l(c))}}),window.addEventListener("touchstart",function(e){let t=e.touches[0];m=t.clientX,p=t.clientY},{passive:!0}),window.addEventListener("touchend",function(e){let t=e.changedTouches[0],r=t.clientX-m,o=t.clientY-p,s=Math.abs(r),n=Math.abs(o);30>Math.max(s,n)||"playing"!==c.getStatus()||(s>n?r>0?c.moveRight():c.moveLeft():o>0?c.moveDown():c.moveUp(),l(c))},{passive:!0});
//# sourceMappingURL=index.a0347f0f.js.map
